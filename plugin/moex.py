# -*- coding: utf8 -*-
''' Получение котировок с moex.com в логин код ценной бумаги
    https://iss.moex.com/iss/engines/stock/markets/shares/securities/TATNP 
    https://iss.moex.com/iss/securities/TATNP.xml'''
''' Автор ArtyLa '''
import os, sys, re, time, logging
import requests
import xml.etree.ElementTree as etree
import store, settings

icon = '789C73F235636100033320D600620128666450804840E5918191D411B2F17F2040E6EB8B1D663092C4AED61028AE2F7E18AB7E909CB9FC31860897F30C263247C17C74BD160AC719C29C21F2C8FA0D248E30B81B9D66D8B8E225C3A78F7F1826B63C00AA3D86A2D746F504C3C2A94F183EBEFBCDB064E6330647AD936071907E5DD1C30C793157197EFFFE07E2333CBEFF9D2123EC0A03C85C901A102E4BBBC1F0F2F94FB0FCD72F7F1962BC2E32188843F58B1C66284BBD0195FB03A6EFDDFAC610E379814147F830433AD0AC678F7F30FCFDF38FE1DBD7BF0C7F80744AD0257058C0F49742F5EFDAF49A61F3AA9760B75CBBF899A124F926C3EE8DEFC1762E9BF38CE1F4D18F60B9E440ECFAD72F7BC1600EF4FBBA252F18FE00D5BD79F98B61FBEA770C1D95F7198CA58F321CDBFF1EAFFE0DCB5F32A8721F6448F2BFCCF00AEADF4BA73F33789B9E6150E73BC470EC007EFD20FB2D958E334C6E79CCB017E8EEF76F7E33FCFEF58F61D1F4A70C6672C7188EEEC3AF7FE7C6D7403380F1F8E12FC3E6E56F186A726E333C02C6C7F76F7F81663C613875F80356FDB0F0FFF9E32F3CFCC39D2F3068091E62480DBECCF0F4D10FB83C285C9291C21F9466E3BC2F32DCB9F9156CCFBAA52FC1E905960641E9C059F714C3EECD6F80F1F787E1F2B94F0C41B6E7C0E2B0F40B0ADB50C7F30C5D35F7181CB54F82D30672FA05F1BDCDCE307456DF63F0B33C8335FF184A8068CCB48F9C8ED1E5D1F31F39F91700FC5ECFCF'

def get_balance(login, password, storename=None):
    result = {}
    session = requests.Session()
    url = time.strftime(f'https://iss.moex.com/iss/engines/stock/markets/shares/securities/{login}')
    response = session.get(url)
    root=etree.fromstring(response.text)
    rows = root.findall('*[@id="marketdata"]/rows')[0]
    result['Balance'] = [c.get('LAST') for c in rows.getchildren() if c.get('LAST')!=''][0]
    return result


if __name__ == '__main__':
    print('This is module moex')
